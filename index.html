<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FreePro - Calculadoras Profissionais</title>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --secondary: #22c55e;
      --secondary-dark: #16a34a;
      --accent: #8b5cf6;
      --warning: #f59e0b;
      --danger: #dc2626;
      --success: #22c55e;
      --bg-primary: #111827;
      --bg-secondary: #1f2937;
      --bg-card: #374151;
      --text-primary: #f9fafb;
      --text-secondary: #d1d5db;
      --text-muted: #9ca3af;
      --border: #4b5563;
      --border-light: #6b7280;
    }

    /* Tema claro */
    [data-theme="light"] {
      --bg-primary: #f8fafc;
      --bg-secondary: #f1f5f9;
      --bg-card: #ffffff;
      --text-primary: #1e293b;
      --text-secondary: #475569;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --border-light: #cbd5e1;
    }

    * { box-sizing: border-box; }
    
    body {
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-card) 100%);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      margin: 0;
      line-height: 1.5;
      transition: background 0.3s ease, color 0.3s ease;
    }

    .main-header {
      background: rgba(17, 24, 39, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      padding: 1rem 0;
      position: sticky;
      top: 0;
      z-index: 50;
      transition: background 0.3s ease;
    }

    [data-theme="light"] .main-header {
      background: rgba(248, 250, 252, 0.95);
    }

    .main-title {
      font-size: 2rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-align: center;
      margin: 0;
    }

    .main-subtitle {
      text-align: center;
      color: var(--text-secondary);
      margin-top: 0.25rem;
      font-size: 0.875rem;
    }

    .header-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-top: 1rem;
    }

    .theme-toggle {
      background: rgba(55, 65, 81, 0.8);
      border: 2px solid var(--border);
      border-radius: 25px;
      color: var(--text-primary);
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    [data-theme="light"] .theme-toggle {
      background: rgba(255, 255, 255, 0.9);
    }

    .theme-toggle:hover {
      border-color: var(--primary);
      transform: translateY(-1px);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    .auth-container {
      max-width: 400px;
      margin: 2rem auto;
      padding: 2rem;
      background: rgba(55, 65, 81, 0.4);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
      border-radius: 16px;
      transition: all 0.3s ease;
    }

    [data-theme="light"] .auth-container {
      background: rgba(255, 255, 255, 0.7);
    }

    .auth-title {
      font-size: 1.5rem;
      font-weight: 800;
      text-align: center;
      margin-bottom: 1.5rem;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .form-group {
      margin-bottom: 0.75rem;
    }

    .form-label {
      display: block;
      font-weight: 600;
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-bottom: 0.375rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .form-input, .form-select {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid var(--border);
      border-radius: 8px;
      background: rgba(17, 24, 39, 0.8);
      color: var(--text-primary);
      font-size: 0.875rem;
      transition: all 0.2s ease;
    }

    [data-theme="light"] .form-input,
    [data-theme="light"] .form-select {
      background: rgba(255, 255, 255, 0.9);
    }

    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.05em;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .btn-secondary {
      background: rgba(55, 65, 81, 0.8);
      color: var(--text-primary);
      border: 2px solid var(--border);
      transition: all 0.3s ease;
    }

    [data-theme="light"] .btn-secondary {
      background: rgba(255, 255, 255, 0.9);
    }

    .btn-secondary:hover {
      border-color: var(--border-light);
      transform: translateY(-1px);
    }

    .subscription-plans {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 2rem 0;
    }

    .plan-card {
      background: rgba(31, 41, 59, 0.8);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    [data-theme="light"] .plan-card {
      background: rgba(255, 255, 255, 0.9);
    }

    .plan-card:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
    }

    .plan-card.popular {
      border-color: var(--primary);
      position: relative;
    }

    .plan-card.popular::before {
      content: 'POPULAR';
      position: absolute;
      top: -8px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.625rem;
      font-weight: 700;
    }

    .plan-name {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .plan-price {
      font-size: 1.75rem;
      font-weight: 800;
      color: var(--primary);
      font-family: ui-monospace, monospace;
    }

    .plan-period {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .plan-discount {
      background: linear-gradient(135deg, var(--success), var(--secondary-dark));
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 8px;
      font-size: 0.75rem;
      font-weight: 600;
      margin: 0.5rem 0;
      display: inline-block;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.75rem 1rem;
      background: rgba(31, 41, 59, 0.6);
      border-radius: 8px;
      margin-left: auto;
    }

    [data-theme="light"] .user-info {
      background: rgba(255, 255, 255, 0.7);
    }

    .user-email {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .user-status {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      color: var(--success);
    }

    .user-expires {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .logout-btn {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-secondary);
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.75rem;
      transition: all 0.2s ease;
    }

    .logout-btn:hover {
      border-color: var(--danger);
      color: var(--danger);
    }

    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .hidden { display: none !important; }

    .tabs-container {
      background: rgba(31, 41, 59, 0.8);
      border-radius: 12px;
      padding: 0.5rem;
      display: flex;
      gap: 0.25rem;
      margin: 1.5rem auto;
      max-width: 500px;
      border: 1px solid var(--border);
      transition: background 0.3s ease;
    }

    [data-theme="light"] .tabs-container {
      background: rgba(255, 255, 255, 0.9);
    }

    .tab {
      flex: 1;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    .tab[aria-selected="true"] {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      transform: translateY(-1px);
    }

    .tab:hover:not([aria-selected="true"]) {
      background: rgba(59, 130, 246, 0.1);
      color: var(--text-primary);
    }

    .panel {
      background: rgba(55, 65, 81, 0.4);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1rem 0;
      transition: background 0.3s ease;
    }

    [data-theme="light"] .panel {
      background: rgba(255, 255, 255, 0.7);
    }

    .card {
      background: rgba(31, 41, 59, 0.8);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      transition: all 0.3s ease;
    }

    [data-theme="light"] .card {
      background: rgba(255, 255, 255, 0.9);
    }

    .card:hover {
      border-color: var(--border-light);
      transform: translateY(-1px);
    }

    .section-title {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .section-title::before {
      content: '';
      width: 3px;
      height: 20px;
      background: linear-gradient(180deg, var(--primary), var(--secondary));
      border-radius: 2px;
    }

    .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }

    .stat-card {
      background: rgba(17, 24, 39, 0.6);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
      transition: all 0.3s ease;
      min-height: 80px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    [data-theme="light"] .stat-card {
      background: rgba(255, 255, 255, 0.8);
    }

    .stat-card:hover {
      border-color: var(--border-light);
    }

    .stat-value {
      font-size: 1.25rem;
      font-weight: 800;
      font-family: ui-monospace, monospace;
      margin-bottom: 0.25rem;
      color: var(--primary);
    }

    .stat-label {
      font-size: 0.625rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-weight: 600;
    }

    .house-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .house-card {
      background: linear-gradient(135deg, rgba(31, 41, 59, 0.8), rgba(55, 65, 81, 0.6));
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      transition: all 0.3s ease;
      position: relative;
    }

    [data-theme="light"] .house-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.8));
    }

    .house-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border-radius: 12px 12px 0 0;
    }

    .house-card:hover {
      transform: translateY(-2px);
      border-color: var(--border-light);
    }

    .house-title {
      font-size: 0.875rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.75rem;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 0.5rem 0;
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .checkbox-group input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: var(--primary);
    }

    .btn-toggle {
      background: rgba(55, 65, 81, 0.8);
      color: var(--text-secondary);
      border: 2px solid var(--border);
      min-width: 60px;
      padding: 0.75rem 1rem;
      transition: all 0.3s ease;
    }

    [data-theme="light"] .btn-toggle {
      background: rgba(255, 255, 255, 0.9);
    }

    .btn-toggle.active {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      border-color: var(--primary);
    }

    .results-table {
      width: 100%;
      border-collapse: collapse;
      background: rgba(17, 24, 39, 0.8);
      border-radius: 12px;
      overflow: hidden;
      margin-top: 1rem;
      transition: background 0.3s ease;
    }

    [data-theme="light"] .results-table {
      background: rgba(255, 255, 255, 0.9);
    }

    .results-table th {
      background: rgba(17, 24, 39, 0.9);
      color: var(--text-primary);
      font-weight: 700;
      text-transform: uppercase;
      padding: 0.75rem 0.5rem;
      font-size: 0.75rem;
      letter-spacing: 0.05em;
      border-bottom: 2px solid var(--primary);
      transition: background 0.3s ease;
    }

    [data-theme="light"] .results-table th {
      background: rgba(248, 250, 252, 0.9);
    }

    .results-table td {
      padding: 0.75rem 0.5rem;
      border-bottom: 1px solid var(--border);
      color: var(--text-primary);
      font-size: 0.875rem;
    }

    .results-table th:first-child,
    .results-table td:first-child {
      text-align: left;
    }

    .results-table th:not(:first-child),
    .results-table td:not(:first-child) {
      text-align: right;
    }

    .profit-positive { color: #22c55e !important; font-weight: 700 !important; }
    .profit-negative { color: #dc2626 !important; font-weight: 700 !important; }
    .profit-highlight { color: #3b82f6 !important; font-weight: 800 !important; }
    .text-small { font-size: 0.75rem; color: var(--text-muted); }

    @media (max-width: 900px) {
      .grid-2, .grid-3 {
        grid-template-columns: 1fr;
      }
      .house-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .main-title { font-size: 1.75rem; }
      .container { padding: 0 0.75rem; }
      .panel { padding: 1rem; }
      .tabs-container {
        flex-direction: column;
        gap: 0.25rem;
      }
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
      }
      .header-controls {
        margin-top: 0.75rem;
      }
    }

    @media (max-width: 480px) {
      .main-title { font-size: 1.5rem; }
      .stats-grid {
        grid-template-columns: 1fr;
      }
      .stat-card {
        min-height: 70px;
        padding: 0.75rem;
      }
      .results-table {
        font-size: 0.75rem;
      }
      .results-table th,
      .results-table td {
        padding: 0.5rem 0.25rem;
      }
      .header-controls {
        flex-direction: column;
        gap: 0.5rem;
      }
    }
  </style>
</head>
<body>
  <header class="main-header">
    <div class="container">
      <h1 class="main-title">FreePro</h1>
      <p class="main-subtitle">Ferramentas profissionais para otimização de apostas esportivas</p>
      <div class="header-controls">
        <button id="themeToggle" class="theme-toggle">
          🌙 Tema Escuro
        </button>
        
        <!-- Informações do usuário -->
        <div id="userInfo" class="user-info hidden">
          <div>
            <div id="userEmail" class="user-email"></div>
            <div id="userStatus" class="user-status"></div>
            <div id="userExpires" class="user-expires"></div>
          </div>
          <button id="logoutBtn" class="logout-btn">Sair</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Tela de Login -->
  <div id="loginScreen" class="container">
    <div class="auth-container">
      <h2 class="auth-title">Acesso FreePro</h2>
      
      <form id="loginForm">
        <div class="form-group">
          <label class="form-label" for="loginEmail">E-mail</label>
          <input type="email" id="loginEmail" class="form-input" required placeholder="seu@email.com" />
        </div>
        
        <div class="form-group">
          <label class="form-label" for="loginPassword">Senha</label>
          <input type="password" id="loginPassword" class="form-input" required placeholder="Sua senha" />
        </div>
        
        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
          <span id="loginText">Entrar</span>
          <div id="loginSpinner" class="loading-spinner hidden" style="margin: 0 auto;"></div>
        </button>
      </form>
      
      <div style="text-align: center; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border);">
        <p style="color: var(--text-muted); font-size: 0.875rem; margin-bottom: 1rem;">
          Não tem acesso ainda?
        </p>
        <button id="showPlansBtn" class="btn btn-secondary">Ver Planos de Assinatura</button>
      </div>
    </div>
  </div>

  <!-- Tela de Assinatura Expirada -->
  <div id="expiredScreen" class="container hidden">
    <div class="auth-container">
      <h2 class="auth-title" style="color: var(--warning);">⚠️ Assinatura Expirada</h2>
      <p style="color: var(--text-secondary); margin-bottom: 2rem; text-align: center;">
        Sua assinatura FreePro expirou. Renove agora para continuar usando as calculadoras profissionais.
      </p>
      <button id="renewSubscriptionBtn" class="btn btn-primary" style="width: 100%;">Renovar Assinatura</button>
    </div>
  </div>

  <!-- Tela de Planos -->
  <div id="plansScreen" class="container hidden">
    <div style="text-align: center; margin: 2rem 0;">
      <h2 class="auth-title">Escolha seu Plano FreePro</h2>
      <p style="color: var(--text-secondary); margin-bottom: 2rem;">
        Acesso completo às calculadoras profissionais de arbitragem
      </p>
    </div>
    
    <div class="subscription-plans">
      <div class="plan-card" data-plan="monthly">
        <div class="plan-name">Mensal</div>
        <div class="plan-price">R$ 9,90</div>
        <div class="plan-period">por mês</div>
      </div>
      
      <div class="plan-card" data-plan="quarterly">
        <div class="plan-name">Trimestral</div>
        <div class="plan-price">R$ 26,90</div>
        <div class="plan-period">por 3 meses</div>
        <div class="plan-discount">10% desconto</div>
      </div>
      
      <div class="plan-card popular" data-plan="biannual">
        <div class="plan-name">Semestral</div>
        <div class="plan-price">R$ 47,90</div>
        <div class="plan-period">por 6 meses</div>
        <div class="plan-discount">20% desconto</div>
      </div>
      
      <div class="plan-card" data-plan="annual">
        <div class="plan-name">Anual</div>
        <div class="plan-price">R$ 79,90</div>
        <div class="plan-period">por ano</div>
        <div class="plan-discount">33% desconto</div>
      </div>
    </div>
    
    <div style="text-align: center; margin-top: 2rem;">
      <button id="backToLoginBtn" class="btn btn-secondary">Voltar ao Login</button>
    </div>
  </div>

  <!-- Conteúdo Principal (protegido) -->
  <div id="mainContent" class="container hidden">
    <div role="tablist" aria-label="Calculadoras" class="tabs-container">
      <button id="tabBtn1" role="tab" aria-selected="true" aria-controls="panel-1" class="tab" tabindex="0">
        Calculadora ArbiPro
      </button>
      <button id="tabBtn2" role="tab" aria-selected="false" aria-controls="panel-2" class="tab" tabindex="-1">
        Calculadora FreePro
      </button>
    </div>

    <section id="panel-1" role="tabpanel" aria-labelledby="tabBtn1">
      <div class="panel">
        <div id="app"></div>
      </div>
    </section>

    <section id="panel-2" role="tabpanel" aria-labelledby="tabBtn2" hidden>
      <div class="panel">
        <iframe id="calc2frame" title="Calculadora FreePro" style="width: 100%; height: auto; border: none; border-radius: 16px; background: transparent; display: block; overflow: hidden;" scrolling="no"></iframe>
      </div>
    </section>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    
    const firebaseConfig = {
      apiKey: "AIzaSyC6-O6BnUXGzwXwcRM_wRYwGUNFuRpT7NI",
      authDomain: "calculadora-free-pro.firebaseapp.com",
      projectId: "calculadora-free-pro",
      storageBucket: "calculadora-free-pro.firebasestorage.app",
      messagingSenderId: "313485499345",
      appId: "1:313485499345:web:020a4d47f6de604c129ef0",
      measurementId: "G-X7QJD503L6"
    };
    
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    
    // Disponibilizar globalmente
    window.firebaseDb = db;
    window.firebaseGetDoc = getDoc;
    window.firebaseDoc = doc;
  </script>

  <!-- Sistema Principal -->
  <script>
    const FreePro = {
      currentUser: null,
      
      // Elementos DOM
      elements: {
        loginScreen: null,
        expiredScreen: null,
        plansScreen: null,
        mainContent: null,
        userInfo: null,
        loginForm: null,
        loginEmail: null,
        loginPassword: null,
        loginText: null,
        loginSpinner: null,
        userEmailSpan: null,
        userStatusSpan: null,
        userExpiresSpan: null,
        themeToggle: null
      },

      // Inicialização
      init() {
        this.bindElements();
        this.initTheme();
        this.bindEvents();
        this.autoLogin();
      },

      bindElements() {
        this.elements.loginScreen = document.getElementById('loginScreen');
        this.elements.expiredScreen = document.getElementById('expiredScreen');
        this.elements.plansScreen = document.getElementById('plansScreen');
        this.elements.mainContent = document.getElementById('mainContent');
        this.elements.userInfo = document.getElementById('userInfo');
        this.elements.loginForm = document.getElementById('loginForm');
        this.elements.loginEmail = document.getElementById('loginEmail');
        this.elements.loginPassword = document.getElementById('loginPassword');
        this.elements.loginText = document.getElementById('loginText');
        this.elements.loginSpinner = document.getElementById('loginSpinner');
        this.elements.userEmailSpan = document.getElementById('userEmail');
        this.elements.userStatusSpan = document.getElementById('userStatus');
        this.elements.userExpiresSpan = document.getElementById('userExpires');
        this.elements.themeToggle = document.getElementById('themeToggle');
      },

      bindEvents() {
        // Login
        this.elements.loginForm.addEventListener('submit', (e) => {
          e.preventDefault();
          this.loginUser(this.elements.loginEmail.value.trim(), this.elements.loginPassword.value);
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', () => this.logout());

        // Navegação
        document.getElementById('showPlansBtn').addEventListener('click', () => this.showScreen('plans'));
        document.getElementById('backToLoginBtn').addEventListener('click', () => this.showScreen('login'));
        document.getElementById('renewSubscriptionBtn').addEventListener('click', () => this.showScreen('plans'));

        // Planos
        document.querySelectorAll('.plan-card').forEach(card => {
          card.addEventListener('click', () => {
            const plan = card.dataset.plan;
            const lastlinkUrl = `https://pay.lastlink.com.br/sua-conta?plan=${plan}`;
            window.open(lastlinkUrl, '_blank');
          });
        });

        // Tema
        this.elements.themeToggle.addEventListener('click', () => this.toggleTheme());
      },

      // Sistema de temas
      initTheme() {
        const savedTheme = localStorage.getItem('freepro-theme') || 'dark';
        this.setTheme(savedTheme);
      },

      setTheme(theme) {
        const body = document.body;
        if (theme === 'light') {
          body.setAttribute('data-theme', 'light');
          this.elements.themeToggle.innerHTML = '☀️ Tema Claro';
        } else {
          body.removeAttribute('data-theme');
          this.elements.themeToggle.innerHTML = '🌙 Tema Escuro';
        }
        localStorage.setItem('freepro-theme', theme);
      },

      toggleTheme() {
        const currentTheme = document.body.getAttribute('data-theme') === 'light' ? 'light' : 'dark';
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        this.setTheme(newTheme);
      },

      // Utilitários
      showScreen(screen) {
        const screens = {
          login: this.elements.loginScreen,
          expired: this.elements.expiredScreen,
          plans: this.elements.plansScreen,
          main: this.elements.mainContent
        };
        
        Object.values(screens).forEach(s => s.classList.add('hidden'));
        screens[screen].classList.remove('hidden');
      },

      formatDate(dateString) {
        if (!dateString) return 'N/A';
        try {
          return new Date(dateString).toLocaleDateString('pt-BR');
        } catch {
          return 'N/A';
        }
      },

      // Firebase
      async checkSubscription(email) {
        try {
          if (!window.firebaseDb) {
            console.log('Firebase não inicializado');
            return { valid: false, reason: 'firebase_not_ready' };
          }
          
          console.log('=== DEBUG LOGIN ===');
          console.log('Email procurado:', `"${email}"`);
          console.log('Tamanho do email:', email.length);
          
          // Importa as funções necessárias dinamicamente
          const { collection, getDocs, query, where } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
          
          // Primeira tentativa: buscar por ID do documento
          const docRef = window.firebaseDoc(window.firebaseDb, 'users', email);
          console.log('Referência do documento:', docRef.path);
          
          let docSnap = await window.firebaseGetDoc(docRef);
          console.log('Documento existe por ID?', docSnap.exists());
          
          let userData = null;
          
          if (docSnap.exists()) {
            userData = docSnap.data();
            console.log('Dados encontrados por ID:', userData);
          } else {
            // Segunda tentativa: buscar por campo email
            console.log('Tentando buscar por campo email...');
            
            const usersRef = collection(window.firebaseDb, 'users');
            const q = query(usersRef, where("email", "==", email));
            const querySnapshot = await getDocs(q);
            
            console.log('Documentos encontrados por email:', querySnapshot.size);
            
            if (!querySnapshot.empty) {
              querySnapshot.forEach((doc) => {
                console.log('Documento encontrado:', doc.id, doc.data());
                userData = doc.data();
              });
            }
          }
          
          if (!userData) {
            console.log('❌ Usuário não encontrado de forma alguma');
            
            // Lista todos os documentos para debug
            console.log('=== LISTANDO TODOS OS DOCUMENTOS ===');
            const allDocsSnapshot = await getDocs(collection(window.firebaseDb, 'users'));
            console.log('Total de documentos:', allDocsSnapshot.size);
            allDocsSnapshot.forEach((doc) => {
              console.log('ID:', `"${doc.id}"`, '| Email:', doc.data().email, '| Status:', doc.data().status);
            });
            
            return { valid: false, reason: 'user_not_found' };
          }
          
          console.log('✅ Dados do usuário encontrado:', userData);
          
          // Verifica status
          if (userData.status !== 'active') {
            console.log('❌ Status inativo:', userData.status);
            return { valid: false, reason: 'inactive', userData };
          }
          
          // Verifica data de expiração
          const now = new Date();
          let expiresAt = null;
          
          if (userData.expiresAt) {
            if (typeof userData.expiresAt === 'string') {
              // Tenta diferentes formatos de string
              if (userData.expiresAt.includes('de') && userData.expiresAt.includes('UTC')) {
                // Formato brasileiro do Firestore: "1 de outubro de 2025 às 00:00:00 UTC-3"
                // Converte para formato que JS entende
                let dateStr = userData.expiresAt
                  .replace(' de outubro de ', '/10/')
                  .replace(' de novembro de ', '/11/')
                  .replace(' de dezembro de ', '/12/')
                  .replace(' de janeiro de ', '/01/')
                  .replace(' de fevereiro de ', '/02/')
                  .replace(' de março de ', '/03/')
                  .replace(' de abril de ', '/04/')
                  .replace(' de maio de ', '/05/')
                  .replace(' de junho de ', '/06/')
                  .replace(' de julho de ', '/07/')
                  .replace(' de agosto de ', '/08/')
                  .replace(' de setembro de ', '/09/')
                  .replace(' às ', ' ')
                  .replace(' UTC-3', '');
                
                console.log('Convertendo data brasileira:', userData.expiresAt, '->', dateStr);
                expiresAt = new Date(dateStr);
              } else {
                expiresAt = new Date(userData.expiresAt);
              }
              
              console.log('Data processada:', expiresAt);
            } else if (userData.expiresAt.toDate) {
              // Timestamp do Firestore
              expiresAt = userData.expiresAt.toDate();
              console.log('Convertendo Timestamp para data:', expiresAt);
            }
          }
          
          console.log('Data atual:', now);
          console.log('Data de expiração:', expiresAt);
          console.log('Data válida?', expiresAt && !isNaN(expiresAt.getTime()));
          
          if (!expiresAt || isNaN(expiresAt.getTime())) {
            console.log('❌ Data de expiração inválida');
            return { valid: false, reason: 'invalid_date', userData };
          }
          
          console.log('Ainda válida?', expiresAt > now);
          
          if (expiresAt <= now) {
            console.log('❌ Assinatura expirada');
            return { valid: false, reason: 'expired', userData };
          }
          
          console.log('✅ Assinatura válida!');
          return { valid: true, userData };
          
        } catch (error) {
          console.error('❌ Erro ao verificar assinatura:', error);
          return { valid: false, reason: 'error', error: error.message };
        }
      },

      // Autenticação
      async loginUser(email, password) {
        try {
          this.elements.loginText.classList.add('hidden');
          this.elements.loginSpinner.classList.remove('hidden');
          
          if (password.length < 6) {
            throw new Error('Senha deve ter pelo menos 6 caracteres');
          }

          // Aguarda o Firebase estar pronto
          let attempts = 0;
          while (!window.firebaseDb && attempts < 10) {
            await new Promise(resolve => setTimeout(resolve, 500));
            attempts++;
          }

          if (!window.firebaseDb) {
            throw new Error('Sistema não inicializado. Recarregue a página.');
          }
          
          const subscriptionCheck = await this.checkSubscription(email);
          console.log('Subscription check result:', subscriptionCheck);
          
          if (!subscriptionCheck.valid) {
            if (subscriptionCheck.reason === 'user_not_found') {
              throw new Error('Usuário não encontrado. Verifique o e-mail ou adquira uma assinatura.');
            }
            if (subscriptionCheck.reason === 'expired') {
              this.currentUser = { email, ...subscriptionCheck.userData };
              localStorage.setItem('freepro_user', JSON.stringify(this.currentUser));
              this.showScreen('expired');
              this.updateUserInfo();
              return;
            }
            if (subscriptionCheck.reason === 'inactive') {
              throw new Error('Assinatura inativa. Entre em contato com o suporte.');
            }
            throw new Error('Erro na verificação da assinatura: ' + subscriptionCheck.reason);
          }
          
          this.currentUser = { email, ...subscriptionCheck.userData };
          localStorage.setItem('freepro_user', JSON.stringify(this.currentUser));
          this.showScreen('main');
          this.updateUserInfo();
          
          // Aguarda um pouco antes de inicializar as calculadoras
          setTimeout(() => this.initCalculators(), 300);
          
        } catch (error) {
          console.error('Erro no login:', error);
          alert('Erro no login: ' + error.message);
        } finally {
          this.elements.loginText.classList.remove('hidden');
          this.elements.loginSpinner.classList.add('hidden');
        }
      },

      logout() {
        this.currentUser = null;
        localStorage.removeItem('freepro_user');
        this.showScreen('login');
        this.updateUserInfo();
      },

      async autoLogin() {
        const savedUser = localStorage.getItem('freepro_user');
        if (!savedUser) {
          this.showScreen('login');
          return;
        }
        
        try {
          const userData = JSON.parse(savedUser);
          const subscriptionCheck = await this.checkSubscription(userData.email);
          
          if (subscriptionCheck.valid) {
            this.currentUser = { ...userData, ...subscriptionCheck.userData };
            localStorage.setItem('freepro_user', JSON.stringify(this.currentUser));
            this.showScreen('main');
            this.updateUserInfo();
            this.initCalculators();
          } else if (subscriptionCheck.reason === 'expired') {
            this.currentUser = { ...userData, ...subscriptionCheck.userData };
            localStorage.setItem('freepro_user', JSON.stringify(this.currentUser));
            this.showScreen('expired');
            this.updateUserInfo();
          } else {
            this.logout();
          }
        } catch (error) {
          console.error('Erro no auto-login:', error);
          this.logout();
        }
      },

      updateUserInfo() {
        if (this.currentUser) {
          this.elements.userInfo.classList.remove('hidden');
          this.elements.userEmailSpan.textContent = this.currentUser.email;
          this.elements.userStatusSpan.textContent = this.currentUser.status === 'active' ? 'Ativa' : 'Expirada';
          this.elements.userStatusSpan.style.color = this.currentUser.status === 'active' ? 'var(--success)' : 'var(--warning)';
          this.elements.userExpiresSpan.textContent = `Expira em: ${this.formatDate(this.currentUser.expiresAt)}`;
        } else {
          this.elements.userInfo.classList.add('hidden');
        }
      },

      // Calculadoras
      initCalculators() {
        if (document.querySelector('#app').innerHTML.trim()) return;
        
        setTimeout(() => {
          this.initTabSystem();
          this.initArbiPro();
        }, 100);
      },

      // Sistema de abas
      initTabSystem() {
        const tabs = Array.from(document.querySelectorAll('[role="tab"]'));
        const panels = [document.getElementById('panel-1'), document.getElementById('panel-2')];
        const iframe = document.getElementById('calc2frame');

        const setActive = (index) => {
          tabs.forEach((t,i) => {
            const selected = i === index;
            t.setAttribute('aria-selected', selected ? 'true' : 'false');
            t.tabIndex = selected ? 0 : -1;
            panels[i].hidden = !selected;
          });
          if (index === 1 && !iframe.dataset.loaded) this.loadFreePro();
          tabs[index].focus();
        };

        tabs[0].addEventListener('click', () => setActive(0));
        tabs[1].addEventListener('click', () => setActive(1));

        document.querySelector('[role="tablist"]').addEventListener('keydown', (e) => {
          const current = tabs.findIndex(t => t.getAttribute('aria-selected') === 'true');
          let next = current;
          if (e.key === 'ArrowRight') next = (current + 1) % tabs.length;
          else if (e.key === 'ArrowLeft') next = (current - 1 + tabs.length) % tabs.length;
          else if (e.key === 'Home') next = 0;
          else if (e.key === 'End') next = tabs.length - 1;
          else return;
          e.preventDefault();
          setActive(next);
        });
      },

      // Calculadora FreePro (iframe)
      loadFreePro() {
        const iframe = document.getElementById('calc2frame');
        const html = `<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora FreePro</title>
  <style>
    :root {
      --primary: #3b82f6; --secondary: #22c55e; --warning: #f59e0b;
      --bg-primary: #111827; --text-primary: #f9fafb; --text-secondary: #d1d5db;
      --text-muted: #9ca3af; --border: #4b5563;
    }
    [data-theme="light"] {
      --bg-primary: #f8fafc; --text-primary: #1e293b; --text-secondary: #475569;
      --text-muted: #64748b; --border: #e2e8f0;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: transparent; color: var(--text-primary); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 1rem; transition: color 0.3s ease; }
    .calc-title { font-size: 1.75rem; font-weight: 800; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; margin-bottom: 1rem; }
    .calc-subtitle { color: var(--text-secondary); font-size: 0.875rem; text-align: center; margin-bottom: 2rem; }
    .card { background: rgba(31, 41, 59, 0.8); border: 1px solid var(--border); border-radius: 12px; padding: 1rem; margin-bottom: 1rem; transition: all 0.3s ease; }
    [data-theme="light"] .card { background: rgba(255, 255, 255, 0.9); }
    .form-label { display: block; font-weight: 600; font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.375rem; text-transform: uppercase; }
    .form-control { width: 100%; padding: 0.75rem; border: 2px solid var(--border); border-radius: 8px; background: rgba(17, 24, 39, 0.8); color: var(--text-primary); font-size: 0.875rem; transition: all 0.2s ease; }
    [data-theme="light"] .form-control { background: rgba(255, 255, 255, 0.9); }
    .form-control:focus { outline: none; border-color: var(--primary); }
    .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
    .btn-primary { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; }
    .btn-secondary { background: rgba(55, 65, 81, 0.8); color: var(--text-primary); border: 2px solid var(--border); }
    [data-theme="light"] .btn-secondary { background: rgba(255, 255, 255, 0.9); }
    .results { margin-top: 2rem; padding: 1rem; background: rgba(59, 130, 246, 0.1); border: 2px solid var(--primary); border-radius: 12px; text-align: center; }
    .result-value { font-size: 1.5rem; font-weight: 800; color: var(--primary); margin: 0.5rem 0; }
  </style>
</head>
<body>
  <h1 class="calc-title">Calculadora FreePro</h1>
  <p class="calc-subtitle">Sistema simplificado para cálculo de freebets</p>
  
  <div class="card">
    <div style="margin-bottom: 1rem;">
      <label class="form-label">Valor da Aposta:</label>
      <input type="number" id="stake" class="form-control" placeholder="100" />
    </div>
    <div style="margin-bottom: 1rem;">
      <label class="form-label">Odd:</label>
      <input type="number" id="odd" class="form-control" placeholder="2.5" step="0.01" />
    </div>
    <div style="display: flex; gap: 0.75rem;">
      <button class="btn btn-primary" onclick="calculate()">Calcular</button>
      <button class="btn btn-secondary" onclick="clear()">Limpar</button>
    </div>
  </div>
  
  <div id="results" class="results" style="display: none;">
    <h3>Resultado:</h3>
    <div id="result" class="result-value">R$ 0,00</div>
    <p style="color: var(--text-secondary); font-size: 0.875rem;">Lucro potencial</p>
  </div>

  <script>
    function syncTheme() {
      try {
        const parentTheme = parent.document.body.getAttribute('data-theme');
        document.body.setAttribute('data-theme', parentTheme || 'dark');
      } catch (e) {}
    }
    syncTheme();
    try {
      new MutationObserver(syncTheme).observe(parent.document.body, { attributes: true, attributeFilter: ['data-theme'] });
    } catch (e) {}

    function calculate() {
      const stake = parseFloat(document.getElementById('stake').value) || 0;
      const odd = parseFloat(document.getElementById('odd').value) || 0;
      
      if (stake <= 0 || odd <= 0) {
        alert('Por favor, insira valores válidos');
        return;
      }
      
      const profit = stake * (odd - 1);
      document.getElementById('result').textContent = profit.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
      document.getElementById('results').style.display = 'block';
    }
    
    function clear() {
      document.getElementById('stake').value = '';
      document.getElementById('odd').value = '';
      document.getElementById('results').style.display = 'none';
    }
  <\/script>
</body>
</html>`;

        const doc = (iframe.contentDocument || iframe.contentWindow.document);
        doc.open();
        doc.write(html);
        doc.close();
        
        iframe.style.height = '600px';
        iframe.dataset.loaded = "1";
      },

      // Calculadora ArbiPro
      initArbiPro() {
        const $ = (sel) => document.querySelector(sel);
        
        const parseFlex = (n) => {
          if (!n) return NaN;
          const s = String(n).trim().replace(',', '.');
          return parseFloat(s);
        };

        const fmtBRL = (n) => (Number.isFinite(n) ? n : 0).toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
        const fmtDec = (n) => Number.isFinite(n) ? n.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : "";

        let numHouses = 2;
        let houses = [
          { odd: "", stake: "100", commission: null, freebet: false, fixedStake: true, lay: false },
          { odd: "", stake: "0", commission: null, freebet: false, fixedStake: false, lay: false }
        ];

        const renderApp = () => {
          const app = $("#app");
          app.innerHTML = `
            <div style="text-align: center; margin-bottom: 1.5rem;">
              <h1 style="font-size: 1.75rem; font-weight: 800; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0.5rem;">Calculadora ArbiPro</h1>
              <p style="color: var(--text-secondary); font-size: 0.875rem;">Calcule stakes otimizados para garantir lucro</p>
            </div>

            <div class="stats-grid">
              <div class="card">
                <div class="section-title" style="font-size: 0.875rem; margin-bottom: 0.75rem;">Configurações</div>
                <div class="form-group">
                  <label class="form-label">Número de Casas:</label>
                  <select id="numHouses" class="form-select">
                    <option value="2" ${numHouses===2?'selected':''}>2 Casas</option>
                    <option value="3" ${numHouses===3?'selected':''}>3 Casas</option>
                  </select>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-value" id="totalStake">R$ 0,00</div>
                <div class="stat-label">Total Investido</div>
              </div>

              <div class="stat-card">
                <div class="stat-value profit-highlight" id="roi">0,00%</div>
                <div class="stat-label">ROI Estimado</div>
              </div>
            </div>

            <div class="card">
              <div class="section-title">Casas de Apostas</div>
              <div id="houses" class="house-grid"></div>
            </div>

            <div class="card">
              <div class="section-title">Resultados</div>
              <div id="results">Configure as odds para ver os resultados</div>
            </div>
          `;

          this.renderHouses();
          this.bindArbiProEvents();
        };

        this.renderHouses = () => {
          const container = document.getElementById("houses");
          if (!container) return;

          container.innerHTML = houses.slice(0, numHouses).map((h, idx) => `
            <div class="house-card">
              <h3 class="house-title">Casa ${idx + 1}</h3>
              
              <div class="form-group">
                <label class="form-label">Odd</label>
                <input data-idx="${idx}" data-field="odd" type="number" step="0.01" value="${h.odd}" class="form-input" placeholder="2.50" />
              </div>
              
              <div class="form-group">
                <label class="form-label">Stake</label>
                <input data-idx="${idx}" data-field="stake" type="number" step="0.01" value="${h.stake}" class="form-input" placeholder="100" />
              </div>
              
              <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                <button data-idx="${idx}" data-action="fixStake" class="btn ${h.fixedStake ? 'btn-primary' : 'btn-secondary'}" style="flex: 1;">
                  ${h.fixedStake ? 'Fixada' : 'Fixar'}
                </button>
                <button data-idx="${idx}" data-action="toggleLay" class="btn ${h.lay ? 'btn-primary' : 'btn-secondary'}">
                  ${h.lay ? 'LAY' : 'BACK'}
                </button>
              </div>
            </div>
          `).join("");
        };

        this.bindArbiProEvents = () => {
          // Mudança no número de casas
          const numHousesSelect = document.getElementById("numHouses");
          if (numHousesSelect) {
            numHousesSelect.addEventListener("change", (e) => {
              numHouses = parseInt(e.target.value);
              while (houses.length < numHouses) {
                houses.push({ odd: "", stake: "0", commission: null, freebet: false, fixedStake: false, lay: false });
              }
              this.renderHouses();
              this.calculate();
            });
          }

          // Input changes
          document.getElementById("houses")?.addEventListener("input", (e) => {
            const idx = parseInt(e.target.dataset.idx);
            const field = e.target.dataset.field;
            if (idx >= 0 && field) {
              houses[idx][field] = e.target.value;
              this.calculate();
            }
          });

          // Button clicks
          document.getElementById("houses")?.addEventListener("click", (e) => {
            const idx = parseInt(e.target.dataset.idx);
            const action = e.target.dataset.action;
            
            if (idx >= 0 && action === "fixStake") {
              houses.forEach((h, i) => h.fixedStake = i === idx ? !h.fixedStake : false);
              this.renderHouses();
              this.calculate();
            }
            
            if (idx >= 0 && action === "toggleLay") {
              houses[idx].lay = !houses[idx].lay;
              this.renderHouses();
              this.calculate();
            }
          });
        };

        this.calculate = () => {
          const active = houses.slice(0, numHouses);
          const fixedIdx = active.findIndex(h => h.fixedStake);
          
          if (fixedIdx === -1) {
            document.getElementById("results").innerHTML = "Fixe uma stake para calcular";
            return;
          }

          const fixed = active[fixedIdx];
          const fixedStake = parseFlex(fixed.stake) || 0;
          const fixedOdd = parseFlex(fixed.odd) || 0;
          
          if (fixedStake <= 0 || fixedOdd <= 0) {
            document.getElementById("results").innerHTML = "Configure stake e odd da casa fixada";
            return;
          }

          const fixedReturn = fixedStake * fixedOdd;
          let totalStake = fixedStake;
          let results = [`Casa ${fixedIdx + 1}: ${fmtBRL(fixedStake)} → ${fmtBRL(fixedReturn)}`];

          active.forEach((h, idx) => {
            if (idx === fixedIdx) return;
            
            const odd = parseFlex(h.odd) || 0;
            if (odd <= 0) return;
            
            const requiredStake = fixedReturn / odd;
            houses[idx].stake = fmtDec(requiredStake);
            totalStake += requiredStake;
            
            results.push(`Casa ${idx + 1}: ${fmtBRL(requiredStake)} → ${fmtBRL(fixedReturn)}`);
          });

          const profit = fixedReturn - totalStake;
          const roi = (profit / totalStake) * 100;

          document.getElementById("totalStake").textContent = fmtBRL(totalStake);
          document.getElementById("roi").textContent = (roi >= 0 ? "+" : "") + roi.toFixed(2) + "%";
          document.getElementById("roi").className = "stat-value " + (roi >= 0 ? "profit-highlight" : "profit-negative");
          
          document.getElementById("results").innerHTML = `
            <div style="margin-bottom: 1rem;">
              <strong>Lucro: ${fmtBRL(profit)}</strong>
            </div>
            <div style="font-size: 0.875rem; color: var(--text-secondary);">
              ${results.join('<br>')}
            </div>
          `;

          this.renderHouses();
        };

        renderApp();
      }
    };

    // Inicializar quando DOM estiver pronto
    document.addEventListener('DOMContentLoaded', () => {
      FreePro.init();
    });

    // Debug global
    window.FreePro = FreePro;
  </script>
</body>
</html>